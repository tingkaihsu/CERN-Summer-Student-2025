# Abstract
This repository contains an automated pipeline for processing and analyzing nuclear reaction data, with a focus on Maxwellian-Averaged Cross Sections (MACS) and Stellar Enhancement Factors (SEF). The system integrates evaluated experimental data from major nuclear databases (ENDF/B-VIII.1, JEFF-3.3, JENDL-5) with theoretical calculations from TALYS-2.0 nuclear reaction code.
# Workflow Overview
There are two main purposes when modifying the database, one is adding new data sheets for new isotope measured at n_TOF facility at CERN, and the other is modifying some existing data sheets.
We provide fast-implementation system that only requires two input files.
Here is the structure of the folders, please make sure you have necessary files and templates in order for `page/app.py` to deploy static webpages correctly.

1. **Data Acquisition**:
   - Web scraping of IAEA database using Selenium
   - Automated download of experimental cross-section data

2. **Theoretical Calculations**(Currently deactivated):
   - Runs TALYS-2.0 nuclear reaction code for both laboratory and stellar environments
   - Processes output files to extract SEF and MACS values

3. **Data Integration**:
   - Combines experimental and theoretical results
   - Calculates temperature-dependent SEF values
   - Formats output with proper uncertainty handling

4. **Output Generation**:
   - Creates comprehensive CSV files with all relevant nuclear data
   - Maintains metadata including Q-values and publication references
   - Special comments can be extracted from `{element}{mass}.csv`
5. **MACS Comparison Plots**: 
   - Visualize multiple datasets with proper uncertainty handling
   - JSON configuration files for precise styling control
   - Custom legend generation with consistent styling
6. **Ratio Plots**: 
   - Show deviations from reference data (typically n_TOF measurements)
   - JSON configuration files for precise styling control
   - Custom legend generation with consistent styling
7. **Fast-implementation of Webpages**:
   - Use `Frozen-Flask` to convert dynamic features such as searching into static version.
   - Handle the REF links properly

```bash
dosef/                          # This is for computation of SEF and TAYLS-MACS from TALYS program
dosef2/                         # This is for computation of SEF and TAYLS-MACS from TALYS program
main/
├── page/
│   ├── app.py                  # Usage: python3 app.py {element} {mass}
│   ├── items.csv               # This is necesssary for app.py to work correctly, and one should copy it down from the current database, and afterward, one should push it onto the database for next use
│   ├── templates/              # HTML templates
│          ├── index.html
│          ├── detail.html
│          ├── search.html
│          └── all_item.html
│   ├── n_TOF_data/             # This folder is generated by the script.py program, and is used for downloading individual txt file
│          └── {element}{mass}.txt
│   ├── database/               # This folder is also generated by the script.py program and is used to generated datasheet in the webpage by app.py
│          └── {element}{mass}.csv
│   ├── static/                 # Storing css setting for webpages, plots, and all nTOF MACS data for download
│         ├── all_nTOF_MACS.txt # This is necessary for app.py to work correctly, and one should copy it down from the current database
│         ├── js/
│              └── pquery.js
│         ├── images/           # Generated plot images
│               ├── {element}{mass}_macs.png
│               ├── cern_logo2.png  # This is necessary for app.py to work correctly, and one should copy it down from the current database
│               ├── logo2.png       # This is necessary for app.py to work correctly, and one should copy it down from the current database
│               ├── n_TOF_logo.png  # This is necessary for app.py to work correctly, and one should copy it down from the current database
│               └── ratio/
│                     └── {element}{mass}_macs_ratio.png
│         └── css/               # This is css setting for the webpage, as templates, they are necessary for app.py to work correctly
│              ├── detail.css
│              ├── search_results.css
│              └── style.css
│   └── build/                  # All modifications from app.py will be done here, and one should put all files on the current database here to make sure everything works properly, and afterward one just have to put everything in this folder up to the folder.
│              ├── all-items.html
│              ├── index.html
│              ├── items.json
│              ├── search.html
│              ├── static/
│                     ├── all_nTOF_MACS.txt
│                     ├── js/
│                          └── pquery.js
│                     ├── images/
│                           ├── {element}{mass}_macs.png
│                           ├── cern_logo2.png 
│                           ├── logo2.png 
│                           ├── n_TOF_logo.png 
│                           └── ratio/
│                                 └── {element}{mass}_macs_ratio.png
│                     └── css/
│                           ├── detail.css
│                           ├── search_results.css
│                           └── style.css
│              └── detail/           # app.py should not modify files here if not required
│                    ├── {id}.html   # Individual webpages generated from app.py, and it should follow the css setting of static/detail.css and the HTML template templates/detail/html
│                    └── n_TOF_data/ 
│                           └── {element}{mass}.txt
├── plot_MACS.py             # This is used for plotting the comparison MACS and ratio
├── script.py                # This computes TALYS-2.0 program for SEF and MACS (currently deactivated), and download online evaluated x-sections from libraries, and combine everything.
├── run.sh                   # USAGE ./run.sh {element} {mass} {digit-hint}
├── run_batch.sh             # USAGE ./run_batch.sh jobs.txt
├── jobs.txt                 # This contains {element} {mass} {digit-hint}, which is more efficiency than run.sh
├── logs/                    # This records the message of run_batch.sh
│   └── {element}{mass}.log
├── downloaded/              # This contains online evaluated x-sections from libraries
│   └── {element}{mass}_{lab}.txt
└── {element}{mass}/          # This should contain two necessary inputs, and there can be others file after running script.py
│          ├── {element}{mass}.json
│          ├── {element}{mass}_LAB_MACS.csv # This is evaluated from the TALYS program (currently deactivated)
│          ├── {element}{mass}_SEF.csv  # This is evaluated from the TALYS program (currently deactivated)
│          └── {element}{mass}.csv
```
Below contains the necessary files before running the program, one can compare it with the above structure.
```bash
dosef/                          # This is for computation of SEF and TAYLS-MACS from TALYS program
dosef2/                         # This is for computation of SEF and TAYLS-MACS from TALYS program
main/
├── page/
│   ├── app.py                  # Usage: python3 app.py {element} {mass}
│   ├── items.csv               # This is necesssary for app.py to work correctly, and one should copy it down from the current database, and afterward, one should push it onto the database for next use
│   ├── templates/              # HTML templates
│          ├── index.html
│          ├── detail.html
│          ├── search.html
│          └── all_item.html
│   ├── static/                 # Storing css setting for webpages, plots, and all nTOF MACS data for download
│         ├── all_nTOF_MACS.txt # This is necessary for app.py to work correctly, and one should copy it down from the current database
│         ├── js/
│              └── pquery.js
│         ├── images/
│               ├── cern_logo2.png  # This is necessary for app.py to work correctly, and one should copy it down from the current database
│               ├── logo2.png       # This is necessary for app.py to work correctly, and one should copy it down from the current database
│               ├── n_TOF_logo.png  # This is necessary for app.py to work correctly, and one should copy it down from the current database
│         └── css/               # This is css setting for the webpage, as templates, they are necessary for app.py to work correctly
│              ├── detail.css
│              ├── search_results.css
│              └── style.css
│   └── build/                  # All modifications from app.py will be done here, and one should put all files on the current database here to make sure everything works properly, and afterward one just have to put everything in this folder up to the folder.
│              ├── all-items.html
│              ├── index.html
│              ├── items.json
│              ├── search.html
│              ├── static/
│                     ├── all_nTOF_MACS.txt
│                     ├── js/
│                          └── pquery.js
│                     ├── images/
│                           ├── {element}{mass}_macs.png
│                           ├── cern_logo2.png 
│                           ├── logo2.png 
│                           ├── n_TOF_logo.png 
│                           └── ratio/
│                                 └── {element}{mass}_macs_ratio.png
│                     └── css/
│                           ├── detail.css
│                           ├── search_results.css
│                           └── style.css
│              └── detail/           # app.py should not modify files here if not required
│                    ├── {id}.html   # Individual webpages generated from app.py, and it should follow the css setting of static/detail.css and the HTML template templates/detail/html
│                    └── n_TOF_data/ 
│                           └── {element}{mass}.txt
├── plot_MACS.py             # This is used for plotting the comparison MACS and ratio
├── script.py                # This computes TALYS-2.0 program for SEF and MACS (currently deactivated), and download online evaluated x-sections from libraries, and combine everything.
├── run.sh                   # USAGE ./run.sh {element} {mass} {digit-hint}
├── run_batch.sh             # USAGE ./run_batch.sh jobs.txt
├── jobs.txt                 # This contains {element} {mass} {digit-hint}, which is more efficiency than run.sh
└── {element}{mass}/          # This should contain two necessary inputs, and there can be others file after running script.py
│          ├── {element}{mass}.json
│          ├── {element}{mass}_LAB_MACS.csv # This is evaluated from the TALYS program (currently deactivated)
│          ├── {element}{mass}_SEF.csv  # This is evaluated from the TALYS program (currently deactivated)
│          └── {element}{mass}.csv
```
# Usage
As mentioned, one should first copy all files from current database, and put `items.csv` in `main/page/`, `all_nTOF_MACS.txt` in `main/page/static/`, and others into the `main/page/build/` folder.
Then one is able to add/modify data by the following instructions.

For single run, use `run.sh`
```bash
  ./run.sh {element} {mass} {format_hint}
```
For many new/modified data, we provide `run_batch.sh` to handle a batch of inputs
```bash
  ./run_batch.sh jobs.txt
```
# Example
The structure looks massive and complicated, so we provide a simple example `b10\` that one can add it to the database, and the modification of old data work in the similar way.
## Example Input
In fact, for the required input, the MACS measured at n_TOF `b10.csv` and the plotting configuration `b10.json`, we borrow data from the `au197`.
Here is just served to provide a typical format of the inputs.
The MACS at n_TOF should have the following format:
```bash
   # Main Publication of the n_TOF Collaboration : <br>Au197(n,g) cross section in the unresolved resonance region<br>C. Lederer, N. Colonna, C. Domingo-Pardo, F. Gunsing, F. Käppeler, C. Massimi, A. Mengoni, A. Wallner, U. Abbondanno, G. Aerts et al. (The n_TOF Collaboration)<br>Physical Review C 83, 034608 (2011)
   # Comment : <br>n_TOF full energy range
   # REF https://doi.org/10.1103/PhysRevC.83.034608
   kT (keV),n_TOF (mb)
   6.0,1729 ± 61
   7.0,1550 ± 54
   8.0,1412 ± 49
   ...
```
Note that the keywords `kT (keV)` and `n_TOF (mb)` should be exactly correct in order for the program to capture the data properly.
The plotting configuration input is necessary if one would like to specify the consistent plotting style of each sources:
```json
   [
      {
         "column": "n_TOF (mb)",
         "label": "n_TOF",
         "color": "green",
         "marker": "s",
         "with_unc": true,
         "line_style": ":",
         "line_width": 2,
         "line_alpha": 0.3,
         "marker_size": 50
      },
      {
         "column": "TALYS-2.0 (mb)",
         "label": "TALYS-2.0",
         "color": "blue",
         "marker": "o",
         "with_unc": false,
         "line_style": ":",
         "line_width": 2,
         "line_alpha": 0.3,
         "marker_size": 50
      },
      ...
   ]
```
## Usage
For this single example, we can use `run.sh`:
```bash
./run.sh b 10 0
```
## Notes
After running the script, we recommend the user to check if the code work correctly, here are some points to notice:
1. 
2. 
# Requirements

- Python 3.7+
- Required packages: `selenium`, `pandas`, `numpy`, `scipy`, `requests`
- TALYS nuclear reaction code (with dosef extension)
- ChromeDriver for web scraping functionality
- For more details see the `requirement.txt`
