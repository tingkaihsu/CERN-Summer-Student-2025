<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{{ item.title }} - Nuclear Data</title>
    <!-- Link to detail page stylesheet -->
    <link rel="stylesheet" href="/static/css/detail.css">
    <style>
        /* NEW NAVIGATION BAR STYLES */
        .nav-bar {
            display: flex;
            justify-content: space-between;
            align-items: flex-start; /* changed from 'left' to 'flex-start' */
            margin-bottom: 25px;
            padding: 12px 20px;
            background: rgba(240, 234, 214, 0.95);
            border-radius: 50px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .nav-group {
            display: flex;
            gap: 15px;
        }
        
        .home-link {
            display: inline-block;
            padding: 10px 20px;
            background: linear-gradient(135deg, #6c9ce0, #4a77c9);
            color: white;
            text-decoration: none;
            border-radius: 50px;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
        }
        
        .home-link:hover {
            background: linear-gradient(135deg, #7ca9f0, #5a87d9);
            box-shadow: 0 6px 12px rgba(0,0,0,0.3);
            transform: translateY(-2px);
        }

        /* stack the left nav-group vertically */
        .nav-bar .nav-left {
            display: flex;
            flex-direction: column;
            gap: 10px;
            align-items: flex-start;
        }
    </style>
</head>
<body>
    <!-- INSTITUTIONAL LOGOS -->
    <div class="logos">
        <img src="{{ url_for('static', filename='images/cern_logo2.png', _external=False) }}" 
            alt="CERN Logo" 
            class="logo"
            title="European Organization for Nuclear Research">
        <img src="{{ url_for('static', filename='images/n_TOF_logo.png', _external=False) }}" 
            alt="n_TOF Logo" 
            class="logo"
            title="Neutron Time-of-Flight Facility at CERN">
    </div>

    <!-- NEW NAVIGATION BAR -->
    <div class="nav-bar">
        <!-- LEFT COLUMN: Back + Home stacked -->
        <div class="nav-group nav-left">
            <a class="home-link" 
               href="../index.html" 
               title="Start a new search">
                Home
            </a>
            <a class="back-link" 
               href="{{ search_url or '../search.html' }}">
                ‚Üê Back to Search Results
            </a>
        </div>
        
        <div class="nav-group">
            <!-- Right-side controls (if any) remain empty for now -->
        </div>
    </div>

    <!-- PAGE HEADER -->
    <h1>{{ item.title }}</h1>
    
    <!-- DATA DOWNLOAD SECTION -->
    {% if ntof_available %}
        <p>
            <a href="n_TOF_data/{{ ntof_filename }}" download>
                Download n_TOF MACS Data (Tab-separated ASCII format)
            </a>
        </p>
    {% endif %}

    <!-- METADATA SECTION -->
    <!-- Displays fundamental properties of the isotope -->
    <section class="metadata">
        <h2>{{ item.title }} Basic Properties</h2>

        {# Special handling for reference links #}
        {% for key, value in metadata.items() %}
            {% if key == 'REF' %}
                {# Handle multiple reference formats: #}
                {# - Pre-formatted HTML links #}
                {# - Raw URLs #}
                {# - Plain text references #}
                {% if value is sequence and not value is string %}
                    {% for v in value %}
                        {% if v is string and 'href=' in v %}
                            {# Pre-rendered HTML link (safe to output directly) #}
                            <p><strong>REF:</strong> {{ v | safe }}</p>
                        {% elif v is string and v.startswith('http') %}
                            {# Raw URL converted to clickable link #}
                            <p><strong>REF:</strong> <a href="{{ v }}" target="_blank" rel="noopener noreferrer">{{ v }}</a></p>
                        {% else %}
                            {# Plain text reference #}
                            <p><strong>REF:</strong> {{ v }}</p>
                        {% endif %}
                    {% endfor %}
                {% else %}
                    {# Single reference value #}
                    {% set v = value %}
                    {% if v is string and 'href=' in v %}
                        <p><strong>REF:</strong> {{ v | safe }}</p>
                    {% elif v is string and v.startswith('http') %}
                        <p><strong>REF:</strong> <a href="{{ v }}" target="_blank" rel="noopener noreferrer">{{ v }}</a></p>
                    {% else %}
                        <p><strong>REF:</strong> {{ v }}</p>
                    {% endif %}
                {% endif %}
            {% else %}
                {# Non-REF metadata #}
                <p><strong>{{ key }}:</strong> {{ value | safe }}</p>
            {% endif %}
        {% endfor %}
    </section>

    <!-- DATA SOURCE ATTRIBUTION -->
    <p>
        Q value obtained from the <a href="https://nds.iaea.org/talys/" target="_blank" rel="noopener noreferrer">TALYS-2.0</a> program.
    </p>

    <!-- MAIN DATA TABLE -->
    <!-- Displays ground-state MACS values at different temperatures -->
    <section class="item-details">
        <h2>{{ item.title }} Ground-state MACS at Different Temperatures</h2>
        <table>
            <thead>
                <tr>
                    {% for col in table_headers %}
                        <th>{{ col }}</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for row in item_details %}
                    <tr>
                        {% for cell in row %}
                            <td>{{ cell }}</td>
                        {% endfor %}
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </section>
    
    <!-- VISUALIZATION SECTION -->
    <!-- Displays MACS comparison plots if available -->
    {% if image_exists %}
    <section class="macs-plot">
        <h2>MACS Visualization for {{ item.title }}</h2>

        <!-- Plot container with side-by-side comparison -->
        <div class="macs-plot-row">
            <!-- Left panel: Main MACS plot -->
            <div class="plot-card">
                <img 
                    src="{{ macs_url }}" 
                    alt="Ground-state MACS Plot for {{ item.title }}"
                    title="Comparison of MACS values from different sources"
                >
                <p class="plot-caption">MACS Comparison</p>
            </div>

            <!-- Right panel: Ratio plot -->
            <div class="plot-card">
                <img 
                    src="{{ ratio_url }}" 
                    alt="Ratio plot for {{ item.title }}"
                    title="Ratio to reference values"
                >
                <p class="plot-caption">Ratio to the n_TOF MACS</p>
            </div>
        </div>
    </section>
    {% endif %}
    
    <!-- FOOTER WITH DATA SOURCES AND ATTRIBUTIONS -->
    <footer>
        <h3>Data Sources and References</h3>
        <p>
            <b>Full list of n_TOF experiment references:</b> 
            <a href="https://twiki.cern.ch/NTOFPublic/ListOfPublicationsShortLoA" target="_blank" rel="noopener noreferrer">
                TWiki at CERN
            </a><br>
            
            <b>Reaction rates:</b> Calculated using n_TOF ground state MACS<br>
            
            <b>Experimental data (KADoNiS):</b> 
            <a href="https://exp-astro.physik.uni-frankfurt.de/kadonis/index.php" target="_blank" rel="noopener noreferrer">
                KADoNiS database
            </a><br>
            
            <b>TALYS MACS values:</b> Calculated with 
            <a href="https://nds.iaea.org/talys/" target="_blank" rel="noopener noreferrer">
                TALYS-2.0
            </a> using default parameters<br>
            
            <b>Stellar Enhancement Factor (SEF):</b> Evaluated with TALYS-2.0, by dividing the stellar capture reaction rate to the ground-state rate<br>.
            
            <b>Evaluated MACS values:</b> calculated with evaluated cross-sections available from the
            <a href="https://www-nds.iaea.org/exfor/endf.htm" target="_blank" rel="noopener noreferrer">
                IAEA database
            </a>
        </p>
    </footer>
</body>
</html>